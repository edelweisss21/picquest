const header=document.querySelector(".header"),searchInput=document.querySelector(".main__input"),form=document.querySelector(".form"),searchBtn=document.querySelector(".search__btn"),materialBox=document.querySelector(".material__box"),materialPhotos=document.querySelector(".material__photos"),sectionPromo=document.querySelector(".promo"),searchResultContainer=document.querySelector(".materials__title-container"),materialBtnPic=document.querySelector(".pic"),materialBtnVid=document.querySelector(".vid"),prevPageBtn=document.getElementById("prev-arrow"),nextPageBtn=document.getElementById("next-arrow"),time=document.getElementById("time"),myHeaders=new Headers;myHeaders.append("Content-Type","application/json"),myHeaders.append("Authorization","xnvx4sqsq761EvR5OTsPduXjIIyeDk0GEfIs42uMPbgG7KL4715EG3pO");const randomPic=e=>{const t=Math.floor(Math.random()*e.length);return sectionPromo.style.backgroundImage=`url('${e[t]}')`},bgArray=["distribution/img/bg.webp","distribution/img/bg-2.webp","distribution/img/bg-3.webp","distribution/img/bg-4.webp","distribution/img/bg-5.webp","distribution/img/bg-6.webp","distribution/img/bg-7.webp","distribution/img/bg-8.webp","distribution/img/bg-9.webp","distribution/img/bg-10.webp"];randomPic(bgArray);const getPicture=async e=>{try{const t=`https://api.pexels.com/v1/search/?page=1&query=${e}&per_page=78`,o=await fetch(t,{headers:myHeaders}),a=await o.json();return a}catch(e){console.error("Error fetching data: ",e)}};let Photos={};const shuffleArray=e=>{if(!e||0===e.length)return[];const t=[...e];return t.sort(()=>Math.random()-.5)},createImg=({img:e,nextPage:t},o=!0)=>{o&&(e=shuffleArray(e));for(let t=0;t<e.length;t++){let o=`<div class="material__item">\n\t\t\t<img class="material__img" loading="lazy" src="${e[t].src.portrait}" alt="${e[t].alt}">\n\t\t\t<div class="material__img-title">\n\t\t\t\t<span>View more details</span>\n\t\t\t</div>\n\t\t\t</div>`;materialPhotos.insertAdjacentHTML("beforeend",o)}Photos.nextPage=t,searchResultContainer.insertAdjacentElement("afterend",materialPhotos);const a=document.querySelectorAll(".material__item");a.forEach((t,o)=>{t.addEventListener("click",()=>{const t=e[o],a=t.src.large,n=t.alt,r=t.photographer,s=t.photographer_url,i=t.src.original,c=t.width,l=t.height;openModalWindow(a,n,r,s,i,c,l)})})},initDefaultPhotos=async()=>{try{const e=await getPicture("cars"),t={img:e.photos,nextPage:e.next_page,prevPage:e.page-1};createImg(t)}catch(e){console.error("Error fetching data: ",e)}};initDefaultPhotos();const clearMaterialPhotos=()=>{materialPhotos.innerHTML=""},getInfoAboutPhotos=async()=>{try{let e={};topic=searchInput.value.trim();const t=await getPicture(topic);if(removeHeading(),clearMaterialPhotos(),0===e.results)throw new Error("We have nothing to show on this topic");if(""===topic)return initDefaultPhotos();e={img:t.photos,results:t.total_results,nextPage:t.next_page};const o=`<h2 class="material__title">${e.results} images were found for your query: "<span class="topic">${topic}</span>"</h2>`;createImg(e),searchResultContainer.innerHTML="",searchResultContainer.insertAdjacentHTML("beforeend",o)}catch(e){const t=`<h2 class="material__title centered">${e.message}</h2>`;searchResultContainer.innerHTML="",searchResultContainer.insertAdjacentHTML("beforeend",t)}};nextPageBtn.addEventListener("click",async function(){try{const e=Photos.nextPage;if(!e){const e='<h2 class="material__title">There are no photos</h2>';searchResultContainer.innerHTML="",materialPhotos.innerHTML="",searchResultContainer.insertAdjacentHTML("beforeend",e)}const t=await fetch(e,{headers:myHeaders}),o=await t.json(),a={img:o.photos,results:o.total_results,nextPage:o.next_page,page:o.page};a.img=shuffleArray(a.img),clearMaterialPhotos(),Photos=a,createImg(a)}catch(e){console.error("Error fetching next page data: ",e)}}),prevPageBtn.addEventListener("click",async function(){try{let e=searchInput.value.trim();""===e&&(e="cars");let t=Photos.page;const o=`https://api.pexels.com/v1/search/?page=${t-1}&query=${e}&per_page=78`,a=await fetch(o,{headers:myHeaders}),n=await a.json(),r={img:n.photos,results:n.total_results,page:n.page,nextPage:n.next_page};clearMaterialPhotos(),Photos=r,createImg(r,!1)}catch(e){console.error("Error fetching previous page data: ",e)}});const removeHeading=()=>{const e=document.querySelector(".material__title");e&&e.remove()},modalWindow=document.querySelector(".modal__window"),openModalWindow=(e,t,o,a,n,r,s)=>{const i=document.querySelector(".modal__window-content"),c=document.querySelector(".modal__window-inner");modalWindow.style.display="block",i.innerHTML="";const l=document.createElement("div");l.classList.add("window__user-box");const d=document.createElement("div");d.classList.add("content-box");const m=document.createElement("img");m.setAttribute("src","./distribution/img/avatar.svg"),m.setAttribute("alt","avatar");const u=document.createElement("img");u.setAttribute("src",e),u.setAttribute("alt",t),u.classList.add("img__in-modal"),u.setAttribute("loading","lazy"),u.addEventListener("click",function(){const e=document.querySelector(".popup");e.classList.remove("hidden"),e.append(u)});const g=document.createElement("a");g.setAttribute("href",a),g.setAttribute("target","_blank"),g.classList.add("photographer__nickname"),g.textContent=o;const p=document.createElement("p");p.classList.add("photo-size"),p.innerHTML=`Original Size <span class="red">${r}</span> x <span class="red">${s}</span>`;const h=document.createElement("a");h.setAttribute("href",n),h.setAttribute("download",""),h.classList.add("download-btn"),h.textContent="Download Image";const y=document.createElement("h2");y.textContent=t,y.classList.add("photo-desc"),l.append(m,g,y),d.append(l,y,p,h),i.append(u,d),c.addEventListener("click",e=>{e.stopPropagation()}),modalWindow.addEventListener("click",function(){modalWindow.style.display="none",document.body.style.overflow="auto"}),document.body.style.overflow="hidden"},closeModalWindow=()=>{modalWindow.style.display="none",document.body.style.overflow="auto"},closeBtn=document.getElementById("close-modal");closeBtn.addEventListener("click",closeModalWindow),form.addEventListener("submit",e=>{e.preventDefault(),getInfoAboutPhotos()}),searchBtn.addEventListener("click",getInfoAboutPhotos);const today=new Date,formatTime=e=>{const t=e.getFullYear(),o=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${t} - ${o} - ${a}`};time.innerHTML=formatTime(today);